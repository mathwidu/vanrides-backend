<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Teste WebSocket VanRides</title>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
</head>
<body>
    <h2>WebSocket Tester - VanRides</h2>
    <button onclick="connect()">Conectar</button>
    <button onclick="enviarLocalizacao()">Enviar Localiza√ß√£o</button>
    <button onclick="disconnect()">Desconectar</button>
    <div id="output"></div>

    <script>
        const output = document.getElementById("output");
        const serverUrl = "wss://vanrides-backend-production.up.railway.app/ws-location";
        const stompClient = new StompJs.Client({
            brokerURL: serverUrl,
            reconnectDelay: 5000,
            debug: function (str) {
                console.log(str);
                output.innerHTML += str + "<br>";
            },
        });

        stompClient.onConnect = (frame) => {
            output.innerHTML += "‚úÖ Conectado!<br>";
            stompClient.subscribe("/topic/localizacao", (message) => {
                output.innerHTML += "üì• Recebido: " + message.body + "<br>";
            });
        };

        stompClient.onStompError = (frame) => {
            output.innerHTML += "‚ùå Erro: " + frame.headers["message"] + "<br>";
        };

        function connect() {
            stompClient.activate();
        }

        function enviarLocalizacao() {
            const payload = {
                latitude: -30.0346,
                longitude: -51.2177,
                idMotorista: 1
            };
            stompClient.publish({
                destination: "/app/enviarLocalizacao",
                body: JSON.stringify(payload)
            });
            output.innerHTML += "üöÄ Localiza√ß√£o enviada<br>";
        }

        function disconnect() {
            stompClient.deactivate();
            output.innerHTML += "üîå Desconectado<br>";
        }
    </script>
</body>
</html>
